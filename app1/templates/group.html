{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Group</title>
    <link rel="stylesheet" href="{% static 'css/group.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/bootstrap-3.4.1-dist/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/index.css' %}">
    <link rel="stylesheet" href="{% static "plugins/codebase/dhtmlxgantt.css" %}"/>
</head>
<body>
<script src="{% static 'js/jquery-3.7.1.min.js' %}"></script>
<script src="{% static 'plugins/bootstrap-3.4.1-dist/js/bootstrap.min.js' %}"></script>
<script src="{% static "plugins/codebase/dhtmlxgantt.js" %}" type="text/javascript"></script>
<script src="{% static "plugins/js.cookie.min.js" %}" type="text/javascript"></script>

<nav class="navbar navbar-default">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse"
                    aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/index/">SDAI</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="/index/">HOME</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                       aria-expanded="false">Register/Login<span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="/register/">Register</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="/login/">Login</a></li>
                        <li><a href="/logout/">Logout</a></li>
                    </ul>
                </li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>


<div class="container">
    <div class="row">
        <h2>{{ group.name }}</h2>
        <a href="delete" class="btn btn-danger"> Delete Project and Group</a>
    </div>
    <div class="row">
        Group Leader: {{ control.username }}
    </div>
    <div class="row">
        <div class="col-md-6">
            <h3>Project Report:</h3>

            <p>1. The project starts at 2024-5-27 and ends at 2024-6-10, with 8 days left to finish.</p>
            <p>2. Currently, 2 tasks have been completed, 1 is in progress, and 1 is ready to start.</p>
            <p>3. Abnormal Tasks: "Setup UOS". Please handle it as soon as possible</p>
        </div>

        <div class="col-md-6">
            <h3 class="row">Group Members</h3>
            <button id="addmember" class="btn btn-primary">Add Member</button>
            <a href="{% url 'chat_room' room_name=group.id %}" target="_blank"><button  class="btn btn-default">To Chat Room</button></a>
            <ul class="list-group my-4">
                {% for member in members %}
                    <li class="list-group-item">
                        <div class="row">
                            <div class="col-md-8">
                                {{ member.username }} - {{ member.email }}
                            </div>
                            <div class="col-md-4">
                                <a href="{% url 'delete_group_member' gid=group.id uid=member.id %}"><button class="btn btn-default">delete</button></a>
                            </div>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="row">
        <div id="gantt_here" style='width:100%; height:500px;'></div>
    </div>


    <div id="popup" class="popup d-flex">
        <div class="popup-content">
            <span class="close">&times;</span>
{#            <h2>Enter Member Email:</h2>#}
{#            <input type="text" id="member-email" class="form-control" placeholder="Email">#}
            <h2>Enter Member Name:</h2>
            <input type="text" id="member-name" class="form-control" placeholder="Username">

            <button id="confirm" class="btn btn-primary">Confirm</button>
            <button id="cancel" class="btn btn-secondary">Cancel</button>
        </div>
    </div>
</div>


<script src="{% static 'js/jquery-3.7.1.min.js' %}"></script>
<script src="{% static "plugins/js.cookie.min.js" %}" type="text/javascript"></script>


<script>
    $(document).ready(function () {

        const csrftoken = Cookies.get('csrftoken');

        // 显示弹窗
        $('#addmember').click(function () {
            $('#popup').show();
        });

        // 关闭弹窗
        $('.close, #cancel').click(function () {
            $('#popup').hide();
            $('#member-name').val(''); // 清空输入框
        });

        // 确认按钮事件
        $('#confirm').click(function () {
            {#var emailValue = $('#member-email').val();#}
            var username = $('#member-name').val();

            if (username) {
                // 获取当前网址并生成目标 URL
                var currentUrl = window.location.href;
                var targetUrl = currentUrl + 'addmember';

                // 发送 AJAX 请求
                $.ajax({
                    url: targetUrl,
                    method: 'POST', // 或者 'GET'
                    data: {username: username,
                    csrfmiddlewaretoken: csrftoken},
                    success: function (response) {
                        if (response.msg === 'success') {
                            alert('Success');
                            location.reload(true);
                        } else {
                            alert('Fail: ' + response.msg);
                        }
                        $('#popup').hide();
                        $('#member-name').val(''); // 清空输入框
                    },
                    error: function (xhr, status, error) {
                        console.error('Request failed:', error);
                        alert('Request failed');
                    }
                });
            } else {
                alert('Please enter a valid username');
            }
        });
    });


    gantt.config.layout = {
    css: "gantt_container",
    rows:[
      {
        cols: [
          {resizer: true, width: 1},
          {view: "timeline", id: "timeline", scrollX:"scrollHor", scrollY:"scrollVer"},
          {view: "scrollbar", scroll: "y", id:"scrollVer"}
        ]
       },
      {view: "scrollbar", scroll: "x", id:"scrollHor", height:20}
    ]
};

    gantt.init("gantt_here");
    gantt.load("/getGanttData/");
</script>
</body>
</html>