{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Group</title>
    <link rel="stylesheet" href="{% static 'css/group.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/bootstrap-3.4.1-dist/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static "plugins/codebase/dhtmlxgantt.css" %}"/>
    {#    <style>#}
    {#        .popup {#}
    {#            display: none;#}
    {#            position: fixed;#}
    {#            z-index: 1;#}
    {#            left: 0;#}
    {#            top: 0;#}
    {#            width: 100%;#}
    {#            height: 100%;#}
    {#            overflow: auto;#}
    {#            background-color: rgba(0, 0, 0, 0.5);#}
    {#            justify-content: center;#}
    {#            align-items: center;#}
    {#        }#}
    {##}
    {#        .popup-content {#}
    {#            background-color: #fefefe;#}
    {#            margin: auto;#}
    {#            padding: 20px;#}
    {#            border: 1px solid #888;#}
    {#            width: 80%;#}
    {#            max-width: 400px;#}
    {#            border-radius: 10px;#}
    {#            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);#}
    {#        }#}
    {##}
    {#        .close {#}
    {#            color: #aaa;#}
    {#            float: right;#}
    {#            font-size: 28px;#}
    {#            font-weight: bold;#}
    {#        }#}
    {##}
    {#        .close:hover,#}
    {#        .close:focus {#}
    {#            color: black;#}
    {#            text-decoration: none;#}
    {#            cursor: pointer;#}
    {#        }#}
    {##}
    {#        .btn {#}
    {#            margin-top: 10px;#}
    {#        }#}
    {#    </style>#}
</head>
<body>
<script src="{% static 'js/jquery-3.7.1.min.js' %}"></script>
<script src="{% static 'plugins/bootstrap-3.4.1-dist/js/bootstrap.min.js' %}"></script>
<script src="{% static "plugins/codebase/dhtmlxgantt.js" %}" type="text/javascript">
    </script>
    <script src="{% static "plugins/js.cookie.min.js" %}" type="text/javascript"></script>
<div class="container">
    <div class="row">
        <h2>{{ group.name }}</h2>
    </div>
    <div class="row">
        Group Leader: {{ control.name }}
    </div>
    <div class="row">
        <div class="col-md-6">
            <h3>Project Report:</h3>

            <p>1. The project starts at 2024-5-27 and ends at 2024-6-10, with 8 days left to finish.</p>
            <p>2. Currently, 2 tasks have been completed, 1 is in progress, and 1 is ready to start.</p>
            <p>3. Abnormal Tasks: "Setup UOS". Please handle it as soon as possible</p>
        </div>

        <div class="col-md-6">
            <h3 class="row">Group Members</h3>
            <button id="addmember" class="btn btn-primary">Add Member</button>
            <ul class="list-group my-4">
                {% for member in members %}
                    <li class="list-group-item">
                        <div class="row">
                            <div class="col-md-8">
                                {{ member.name }} - {{ member.email }}
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-default">edit</button>
                            </div>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="row">
        <div id="gantt_here" style='width:100%; height:500px;'></div>
    </div>


    <div id="popup" class="popup d-flex">
        <div class="popup-content">
            <span class="close">&times;</span>
            <h2>Enter Member Email:</h2>
            <input type="text" id="member-email" class="form-control" placeholder="邮箱">
            <button id="confirm" class="btn btn-primary">Confirm</button>
            <button id="cancel" class="btn btn-secondary">Cancel</button>
        </div>
    </div>
</div>


<script src="{% static 'js/jquery-3.7.1.min.js' %}"></script>

<script>
    $(document).ready(function () {
        // 显示弹窗
        $('#addmember').click(function () {
            $('#popup').show();
        });

        // 关闭弹窗
        $('.close, #cancel').click(function () {
            $('#popup').hide();
            $('#member-email').val(''); // 清空输入框
        });

        // 确认按钮事件
        $('#confirm').click(function () {
            var emailValue = $('#member-email').val();

            if (emailValue) {
                // 获取当前网址并生成目标 URL
                var currentUrl = window.location.href;
                var targetUrl = currentUrl + 'addmember';

                // 发送 AJAX 请求
                $.ajax({
                    url: targetUrl,
                    method: 'POST', // 或者 'GET'
                    data: {email: emailValue},
                    success: function (response) {
                        if (response.msg === 'success') {
                            alert('添加成功');
                        } else {
                            alert('添加失败: ' + response.msg);
                        }
                        $('#popup').hide();
                        $('#member-email').val(''); // 清空输入框
                    },
                    error: function (xhr, status, error) {
                        console.error('请求失败:', error);
                        alert('请求失败');
                    }
                });
            } else {
                alert('请输入有效的邮箱');
            }
        });
    });


    gantt.config.layout = {
    css: "gantt_container",
    rows:[
      {
        cols: [
          {resizer: true, width: 1},
          {view: "timeline", id: "timeline", scrollX:"scrollHor", scrollY:"scrollVer"},
          {view: "scrollbar", scroll: "y", id:"scrollVer"}
        ]
       },
      {view: "scrollbar", scroll: "x", id:"scrollHor", height:20}
    ]
};

    gantt.init("gantt_here");
    gantt.load("/getGanttData/");
</script>
</body>
</html>